<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>AI超元域 v0.2 作者微信：stoeng         本软件完全免费，你如果买到付费的，请申请退款并投诉</title>
    <style>


body {
        margin: 0;
        padding: 0;
      }
      .container {
        display: flex;
        flex-direction: column;
        height: 100vh;
      }
      .row {
        display: flex;
        flex-direction: row;
        flex-grow: 1;
      }
      #left, #right {
        order: 0;
        width: 50%;
      }

      #inputArea {
        display: flex;
        flex-direction: row;
        margin: 10px 0;
      }
      #inputText {
        flex-grow: 1;
      }
            /* 添加按钮背景颜色 */
      #executeCode {
        background-color: #5d5cde;
      }

      button, textarea {
        border-radius: 10px;
      }

            /* 添加新按钮的样式 */
      #switchWebviews {
        background-color: #5d5cde;
        color: white;
        margin-left: 10px;
      }
      #clearText {
        background-color: #5d5cde;
        color: white;
        margin-left: 10px;
      }
      textarea {
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif, sans-serif;  /* 设置字体 */
      color: black;  /* 设置颜色 */
    }


    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <webview id="left" src="https://poe.com/ChatGPT"></webview>
        <webview id="right" src="https://poe.com/Claude-instant"></webview>

      </div>
      <div id="inputArea">
        <textarea id="inputText" rows="2" cols="50"></textarea>
        <button id="executeCode" style="width: 60px; color: white;">发送..</button>
        <button id="switchWebviews" style="width: 60px;">切换AI</button>
        <button id="clearText" style="width: 80px;">清空输入</button>


      </div>
      <!-- <textarea id="console" readonly></textarea> -->
    </div>
    <script>

     document.getElementById("inputText").value = " 欢迎使用AI超元域v0.2  软件作者微信：stoeng    最新版本请联系作者   此款软件完全免费，你如果是付费购买的，请申请退款并差评！";


      const webviewLeft = document.querySelector("#left");
      const webviewRight = document.querySelector("#right");
      //const consoleTextarea = document.querySelector("#console");
      const inputText = document.querySelector("#inputText");
      const executeCodeBtn = document.querySelector("#executeCode");
       webviewLeft.addEventListener("dom-ready", () => {
        //consoleTextarea.value += "> 左侧网页已加载完成\n";
        attachMutationObserver(webviewLeft);
        // 检查页面是否已经加载完成
        webviewLeft.executeJavaScript(`
          if (document.readyState === "complete") {
            // 修改左侧网页的 CSS 样式
            const sidebar = document.querySelector("aside.PageWithSidebarLayout_leftSidebar__Y6XQo");
            if (sidebar) sidebar.style.display = "none";
          } else {
            // 页面未加载完成，等待加载完成后再修改样式
            document.addEventListener("readystatechange", () => {
              if (document.readyState === "complete") {
                const sidebar = document.querySelector("aside.PageWithSidebarLayout_leftSidebar__Y6XQo");
                if (sidebar) sidebar.style.display = "none";
              }
            });
          }
        `);
      });
       webviewRight.addEventListener("dom-ready", () => {
        //consoleTextarea.value += "> 右侧网页已加载完成\n";
        attachMutationObserver(webviewRight);
        // 检查页面是否已经加载完成
        webviewRight.executeJavaScript(`
          if (document.readyState === "complete") {
            // 修改右侧网页的 CSS 样式
            const sidebar = document.querySelector("aside.PageWithSidebarLayout_leftSidebar__Y6XQo");
            if (sidebar) sidebar.style.display = "none";
          } else {
            // 页面未加载完成，等待加载完成后再修改样式
            document.addEventListener("readystatechange", () => {
              if (document.readyState === "complete") {
                const sidebar = document.querySelector("aside.PageWithSidebarLayout_leftSidebar__Y6XQo");
                if (sidebar) sidebar.style.display = "none";
              }
            });
          }
        `);
      });




      // 获取清空输入按钮的引用
      const clearTextBtn = document.querySelector("#clearText");

      // 为清空输入按钮添加点击事件
      clearTextBtn.addEventListener("click", () => {
        inputText.value = "";
      });






      // 获取新按钮的引用
      const switchWebviewsBtn = document.querySelector("#switchWebviews");

      // 初始化 count
      let count = 0;

      // 为新按钮添加点击事件
      switchWebviewsBtn.addEventListener("click", () => {
        //count++;

        if (count === 0) {

          webviewLeft.src = "https://poe.com/Sage";
          webviewRight.src = "https://poe.com/Dragonfly";
          count=1;


        } else if (count=== 1) {

          webviewLeft.src = "https://poe.com/ChatGPT";
          webviewRight.src = "https://poe.com/Claude-instant";
          count=0;

        }
      });


      executeCodeBtn.addEventListener("click", () => {
        const text = inputText.value;
        //inputText.value = "";
        sendTextToWebviews(text);
      });


      function sendTextToWebviews(text) {
  const script = `
    (function() {
      const textareas = document.getElementsByClassName("ChatMessageInputView_textInput__Aervw");
      Array.from(textareas).forEach((textarea) => {
        textarea.value = "${text}";
        textarea.dispatchEvent(new Event('input', { bubbles: true })); //触发文本框的input事件，让输入内容生效
        const keydownEvent = new KeyboardEvent("keydown", {
          bubbles: true,
          cancelable: true,
          key: "Enter",
          keyCode: 13,
        });
        const keyupEvent = new KeyboardEvent("keyup", {
          bubbles: true,
          cancelable: true,
          key: "Enter",
          keyCode: 13,
        });
        textarea.dispatchEvent(keydownEvent); //模拟按下回车键
        textarea.dispatchEvent(keyupEvent); //模拟松开回车键
        setTimeout(() => {
          textarea.value = "";
        }, 1000); //等待一段时间后清空文本框，防止消息发送不成功
      });
    })();
  `;


      webviewLeft.executeJavaScript(script);
       // consoleTextarea.value += "> 在左侧网页中输入文本：" + text + "\n";
        webviewRight.executeJavaScript(script);
        //consoleTextarea.value += "> 在右侧网页中输入文本：" + text + "\n";
      }




      function attachMutationObserver(webview) {
        // 用于监测 webview 内容变化的 MutationObserver
        const observer = new MutationObserver((mutationsList) => {
          for (const mutation of mutationsList) {
            if (mutation.type === "childList") {
              for (const node of mutation.addedNodes) {
                const sidebarEls = node.querySelectorAll("aside.PageWithSidebarLayout_leftSidebar__Y6XQo");
                for (const sidebarEl of sidebarEls) {
                  //consoleTextarea.value += "> 左侧网页中包含了 class='PageWithSidebarLayout_leftSidebar__Y6XQo' 的元素，已移除\n";
                  sidebarEl.remove();  // 移除所有指定元素
                }
              }
            }
          }
        });
         observer.observe(webview, {
          childList: true,
          subtree: true
        });
      }
    </script>
  </body>
</html>
